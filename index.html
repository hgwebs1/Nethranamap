<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Map Log Maker</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<style>
html, body { margin:0; padding:0; height:100%; width:100%; font-family: system-ui, sans-serif; background:#f0f0f0; }
.map-container { display:flex; flex-direction:column; height:100vh; width:100vw; }
.map-box { flex:1; position:relative; }

#zoom-control {
  position:absolute;
  top:10px;
  left:50%;
  transform: translateX(-50%);
  z-index:1002;
  background: rgba(255,255,255,0.9);
  padding:8px 12px;
  border-radius:8px;
  font-size:14px;
  text-align:center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}

#status { position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 6px 12px; border-radius: 6px; font-size: 13px; z-index: 2000; }

#control-panel {
  position: fixed;
  top:50px;
  right:0;
  width:0%;
  height:calc(100% - 50px);
  background:rgba(255,255,255,0.95);
  border-left:2px solid #ccc;
  z-index:1500;
  transition: width 0.3s ease;
  padding:20px;
  overflow:auto;
  font-size:14px;
  display:flex;
  flex-direction:column;
  align-items:center;
  box-sizing:border-box;
}

#control-panel.open { width:40%; }

#control-panel h3 { margin-top:0; text-align:center; }

.panel-input {
  width:90%;
  margin:10px 0;
  display:flex;
  flex-direction:column;
  align-items:center;
}

.panel-input label {
  margin-bottom:4px;
  font-weight:500;
  text-align:center;
}

.panel-input input {
  width:100%;
  padding:6px 8px;
  border:1px solid #ccc;
  border-radius:4px;
  text-align:center;
}

#save-btn {
  margin:12px 0 6px 0;
  padding:8px 14px;
  border:none;
  background:#2196F3;
  color:white;
  font-weight:600;
  border-radius:6px;
  cursor:pointer;
  width:90%;
  transition: background 0.3s;
}

#save-btn:hover { background:#1976D2; }

#log-box {
  width:95%;
  font-size:12px;
  height:200px;
  margin-bottom:12px;
  padding:6px;
  border:1px solid #ccc;
  border-radius:6px;
  resize:none;
  box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
}

.download-btn {
  width:90%;
  padding:10px;
  border:none;
  background:#4CAF50;
  color:white;
  font-weight:600;
  border-radius:6px;
  cursor:pointer;
  font-size:14px;
  margin-bottom:6px;
  transition: background 0.3s;
}

.download-btn:hover { background:#45a049; }

#toggle-panel {
  position: fixed;
  top:10px;
  right:0;
  z-index:1600;
  cursor:pointer;
  background:#333;
  color:white;
  padding:6px 10px;
  border-radius:4px 0 0 4px;
}

@media(max-width:768px){
  #control-panel.open { width:43%; }
}
</style>
</head>
<body>

<div class="map-container">
  <div class="map-box" id="osm-box">
    <div id="zoom-control">
      Zoom: <input type="number" id="zoom-input" min="0" max="19" value="4">
    </div>
    <div id="map1" style="height:100%; width:100%;"></div>
  </div>
</div>

<div id="status">Loading map…</div>
<div id="toggle-panel">☰ Panel</div>
<div id="control-panel">
  <h3>Border Control</h3>

  <div class="panel-input">
    <label for="purple-width">Purple Width</label>
    <input type="number" id="purple-width" step="0.1" value="3">
  </div>

  <div class="panel-input">
    <label for="black-width">Black Width</label>
    <input type="number" id="black-width" step="0.1" value="1">
  </div>

  <button id="save-btn">Save Log</button>

  <h4>Log Box:</h4>
  <textarea id="log-box" readonly></textarea>

  <button class="download-btn" id="download-btn-1">Download JSON</button>
  <button class="download-btn" id="download-btn-2">Download TXT</button>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
const statusBox = document.getElementById('status');
function setStatus(msg, isError=false){
  statusBox.textContent = msg;
  statusBox.style.background = isError ? "rgba(200,0,0,0.7)" : "rgba(0,0,0,0.7)";
}

// Map setup
const center = [20,78];
const zoom = 4;
const map1 = L.map('map1',{
  zoomControl:true,
  scrollWheelZoom:true,
  touchZoom:false,
  attributionControl:false
}).setView(center, zoom);

const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:19
}).addTo(map1);

setStatus("Map loaded. Loading borders…");

let pendingLog=[];
let border_purple, border_black;

function purpleStyle(weight){ return {color:'#B0A0AA', weight:weight, opacity:1, fill:false}; }
function blackStyle(weight, zoom, purpleW){ 
  const dash = Math.max(2, (8 - zoom)*(purpleW/3)); 
  return {color:'#000000', weight:weight, opacity:1, fill:false, dashArray:`${dash},${dash}`}; 
}

// Fetch GeoJSON
fetch('jkl.json')
.then(r=>{if(!r.ok) throw new Error(`HTTP ${r.status}`); return r.json();})
.then(data=>{
  map1.createPane('overlayTop'); map1.getPane('overlayTop').style.zIndex = 650;

  const pW = parseFloat(document.getElementById('purple-width').value);
  const bW = parseFloat(document.getElementById('black-width').value);

  border_purple = L.geoJSON(data, {style:purpleStyle(pW), pane:'overlayTop', interactive:false}).addTo(map1);
  border_black  = L.geoJSON(data, {style:blackStyle(bW,map1.getZoom(),pW), pane:'overlayTop', interactive:false}).addTo(map1);

  map1.fitBounds(border_purple.getBounds(), {padding:[20,20]});

  function updateBorders(){
    let zoomVal = parseInt(document.getElementById('zoom-input').value);
    if(isNaN(zoomVal) || zoomVal<0) zoomVal=0;
    if(zoomVal>19) zoomVal=19;

    map1.setZoom(zoomVal);
    const purpleW = parseFloat(document.getElementById('purple-width').value);
    const blackW  = parseFloat(document.getElementById('black-width').value);

    border_purple.setStyle({weight: purpleW * Math.pow(2,4 - zoomVal)});
    border_black.setStyle(blackStyle(blackW * Math.pow(2,4 - zoomVal), zoomVal, purpleW));
  }

  map1.on('zoomend', ()=>updateBorders());
  updateBorders();
  setStatus("✅ Borders loaded successfully.");
})
.catch(err=>setStatus("⚠️ GeoJSON load failed. Check path.","true"));

// Panel toggle
const panel = document.getElementById('control-panel');
document.getElementById('toggle-panel').addEventListener('click', ()=>{
  panel.classList.toggle('open');
  map1.invalidateSize();
});

// Zoom input
const zoomInput = document.getElementById('zoom-input');
zoomInput.addEventListener('input', ()=>{
  let z = parseInt(zoomInput.value);
  if(isNaN(z) || z<0) z=0;
  if(z>19) z=19;
  map1.setZoom(z);
});

// Border width input
['purple-width','black-width'].forEach(id=>{
  document.getElementById(id).addEventListener('input', ()=>{
    if(border_purple){ map1.fire('zoomend'); }
  });
});

// Save Log button → JSON format
document.getElementById('save-btn').addEventListener('click', ()=>{
  const zoomVal = parseInt(document.getElementById('zoom-input').value);
  const purpleW = parseFloat(document.getElementById('purple-width').value);
  const blackW  = parseFloat(document.getElementById('black-width').value);

  const logEntry = {
    zoom: zoomVal,
    purpleWidth: purpleW,
    blackWidth: blackW
  };
  pendingLog.push(logEntry);

  const logBox = document.getElementById('log-box');
  logBox.value = JSON.stringify(pendingLog, null, 2);
});

// Download method 1
document.getElementById('download-btn-1').addEventListener('click', ()=>{
  const logBox = document.getElementById('log-box');
  const blob = new Blob([logBox.value], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'border-log-method1.json';
  a.click();
  URL.revokeObjectURL(url);
});

// Download method 2
document.getElementById('download-btn-2').addEventListener('click', ()=>{
  const logBox = document.getElementById('log-box');
  const blob = new Blob([logBox.value], {type:'text/plain'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'border-log-method2.txt';
  a.click();
  URL.revokeObjectURL(url);
});
</script>
</body>
</html>